{% extends 'base.html' %}
{% load salon_extras %}

{% block title %}Bewertung abgeben - LK Nails & Lashes{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0" style="border-radius: 20px; background: linear-gradient(135deg, var(--soft-pink) 0%, var(--light-color) 100%);">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="fas fa-star-half-alt text-warning" style="font-size: 3rem;"></i>
                        </div>
                        <img src="http://142.171.70.173/wordpress/wp-content/uploads/2024/09/zipwp-image-4128-scaled-300x300.jpg" alt="LK Nails & Lashes" style="width: 70px; height: 70px; object-fit: cover; border-radius: 50%; margin-bottom: 20px;">
                        <h2 class="font-playfair text-primary-custom mb-2">Bewertung abgeben</h2>
                        <p class="text-muted font-quicksand">Teilen Sie Ihre Erfahrung mit anderen Kunden</p>
                    </div>

                    <!-- Appointment Details -->
                    <div class="card mb-4" style="border-radius: 15px; border: 2px solid var(--secondary-color); background: linear-gradient(135deg, #fff 0%, var(--soft-pink) 100%);">
                        <div class="card-body p-4">
                            <h5 class="font-quicksand fw-600 text-primary-custom mb-3">
                                <i class="fas fa-calendar-check me-2"></i>Ihr Termin
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-2 font-quicksand">
                                        <strong>Datum:</strong> {{ appointment.date|date:"d.m.Y" }}
                                    </p>
                                    <p class="mb-2 font-quicksand">
                                        <strong>Uhrzeit:</strong> {{ appointment.time|time:"H:i" }} Uhr
                                    </p>
                                    {% if appointment.staff %}
                                    <p class="mb-2 font-quicksand">
                                        <strong>Mitarbeiterin:</strong> {{ appointment.staff.user.first_name }} {{ appointment.staff.user.last_name }}
                                    </p>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6">
                                    <p class="mb-2 font-quicksand"><strong>Services:</strong></p>
                                    <ul class="list-unstyled ps-3">
                                        {% for service in services %}
                                        <li class="mb-1 font-quicksand">
                                            <i class="fas fa-check text-success me-1"></i>
                                            {{ service.name }} ({{ service.get_duration_display }})
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Review Form -->
                    <form method="post" id="reviewForm">
                        {% csrf_token %}
                        
                        <!-- Star Rating -->
                        <div class="mb-4">
                            <label class="form-label font-quicksand fw-500 mb-3">{{ form.rating.label }}</label>
                            <div class="star-rating-container">
                                {% for value, label in form.rating.field.choices %}
                                <div class="star-rating-option mb-3 p-3" style="border-radius: 15px; border: 2px solid var(--secondary-color); cursor: pointer; transition: all 0.3s ease;">
                                    <input type="radio" name="rating" value="{{ value }}" id="rating_{{ value }}" class="d-none">
                                    <label for="rating_{{ value }}" class="d-flex align-items-center w-100 cursor-pointer font-quicksand">
                                        <div class="stars me-3">
                                            {% for i in "12345"|make_list %}
                                                {% if forloop.counter <= value %}
                                                    <i class="fas fa-star text-warning" style="font-size: 1.5rem;"></i>
                                                {% else %}
                                                    <i class="far fa-star text-muted" style="font-size: 1.5rem;"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <span class="flex-fill">{{ label }}</span>
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                            {% if form.rating.errors %}
                                <div class="text-danger mt-1 small">{{ form.rating.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- Comment -->
                        <div class="mb-4">
                            <label for="{{ form.comment.id_for_label }}" class="form-label font-quicksand fw-500">{{ form.comment.label }}</label>
                            {{ form.comment }}
                            {% if form.comment.errors %}
                                <div class="text-danger mt-1 small">{{ form.comment.errors.0 }}</div>
                            {% endif %}
                            <small class="text-muted font-quicksand">
                                Erzählen Sie anderen von Ihrer Erfahrung - was hat Ihnen besonders gut gefallen?
                            </small>
                        </div>

                        {% if form.non_field_errors %}
                            <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert" style="border-radius: 15px;">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                {{ form.non_field_errors.0 }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endif %}

                        <!-- Submit Buttons -->
                        <div class="d-flex gap-3">
                            <button type="submit" class="btn btn-primary-custom flex-fill py-3" style="border-radius: 15px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%); border: none; font-family: 'Quicksand', sans-serif; font-weight: 600; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);">
                                <i class="fas fa-paper-plane me-2"></i>Bewertung absenden
                            </button>
                            
                            <a href="{% url 'my_appointments' %}" class="btn btn-outline-secondary py-3 px-4" style="border-radius: 15px; font-family: 'Quicksand', sans-serif; font-weight: 500; border: 2px solid var(--secondary-color);">
                                <i class="fas fa-arrow-left me-2"></i>Zurück
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.star-rating-option {
    transition: all 0.3s ease;
}

.star-rating-option:hover {
    background: linear-gradient(135deg, var(--light-pink) 0%, var(--soft-pink) 100%);
    border-color: var(--primary-color);
    transform: translateY(-2px);
}

.star-rating-option:has(input:checked) {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
    border-color: var(--primary-color);
    color: white;
}

.star-rating-option:has(input:checked) .stars i {
    color: #ffd700 !important;
}

.star-rating-option:has(input:checked) span {
    color: white !important;
}

.cursor-pointer {
    cursor: pointer;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(255, 105, 180, 0.25);
}

.btn-primary-custom:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 105, 180, 0.6);
    transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
    background-color: var(--secondary-color);
    border-color: var(--primary-color);
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-3px);
    transition: all 0.3s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card {
    animation: fadeInUp 0.6s ease-out;
}

h2 {
    font-family: 'Dancing Script', cursive;
    font-weight: 600;
    font-size: 2.2rem;
}

.font-quicksand {
    font-family: 'Quicksand', sans-serif;
}

.text-primary-custom:hover {
    color: var(--accent-color) !important;
    transition: color 0.3s ease;
}
</style>

<script>
// Add smooth hover effects for star rating
document.querySelectorAll('.star-rating-option').forEach(option => {
    option.addEventListener('mouseover', function() {
        this.style.background = 'linear-gradient(135deg, var(--light-pink) 0%, var(--soft-pink) 100%)';
        this.style.borderColor = 'var(--primary-color)';
    });
    
    option.addEventListener('mouseout', function() {
        if (!this.querySelector('input').checked) {
            this.style.background = '';
            this.style.borderColor = 'var(--secondary-color)';
        }
    });
});
</script>
{% endblock %}